<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Clashstats</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script>
      document.getElementById('playerTagForm').addEventListener('submit', function(event) {
        // Prevent form submission
        event.preventDefault();
      
        // Check if form is valid
        if (!this.checkValidity()) {
          event.stopPropagation();
          this.classList.add('was-validated');
        } else {
          const submitButton = document.getElementById('submitButton');
          submitButton.innerHTML = `
              <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
              <span>Loading...</span>
          `;
          submitButton.disabled = true;
      
          const playerTag = document.getElementById('playerTagInput').value.toUpperCase(); // Ensure uppercase when submitting
          this.action = '/battlelog/' + encodeURIComponent(playerTag);
          this.submit();
        }
      }, false);
      </script>
  </head>
<body>
    <div class='d-flex justify-content-center'>
        <h1 class='p-5'>CLASHSTATS</h1>
    </div>
    <form id="playerTagForm" class="row g-3 container mx-auto p-2 needs-validation" style="width: 500px" action="#" method='post' novalidate>
      {% csrf_token %}
      <div>
        <label for="PlayerTag" class="form-label">Player tag</label>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">#</span>
            <input type="text" id="playerTagInput" class="form-control" placeholder="CJG89UPQR" aria-label="Player tag" aria-describedby="playerTagHelpBlock" pattern="[A-Za-z0-9]{9}" oninput="this.value = this.value.toUpperCase()" required>
        </div>
        <div id="playerTagHelpBlock" class="form-text">
        Votre player tag est inscrit sous votre nom lorsque vous cliquer sur votre profile dans Clash Royale.
        </div>
      </div>
      <div class="col-12">
        <button id='submitButton' type="submit" class="btn btn-primary">Sumbit</button>
      </div>
    </form>
    <form id="clanTagForm" class="row g-3 container mx-auto p-3 needs-validation" style="width: 500px" action="#" method='post' novalidate>
      {% csrf_token %}
      <div>
        <label for="ClanTag" class="form-label">Clan tag</label>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">#</span>
            <input type="text" id="clanTagInput" class="form-control" placeholder="G9JVLC2C" aria-label="Clan tag" aria-describedby="clanTagHelpBlock" pattern="[A-Za-z0-9]{9}" oninput="this.value = this.value.toUpperCase()" required>
        </div>
        <div id="playerTagHelpBlock" class="form-text">
          Votre clan tag est inscrit sous votre nom de clan lorsque vous cliquer sur celui-ci dans Clash Royale
        </div>
      </div>
      <div class="col-12">
        <button id='submitButtonClan' type="submit" class="btn btn-primary">Sumbit</button>
      </div>
    </form>
    <script>
        document.getElementById('submitButton').addEventListener('click', function() {
          // Change the button to a spinner
          this.innerHTML = `
              <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
              <span role="status">Loading...</span>
          `;
          this.disabled = true;

          document.getElementById('submitButtonClan').addEventListener('click', function() {
            // Change the button to a spinner
            this.innerHTML = `
                <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                <span role="status">Loading...</span>
            `;
            this.disabled = true;
      
          const playerTag = document.getElementById('playerTagInput').value;
          const form = document.getElementById('playerTagForm');
          form.action = '/battlelog/' + encodeURIComponent(playerTag);
          form.submit();
      });
      
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
